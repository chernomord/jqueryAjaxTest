function getDevices(e){var n=$.Deferred();return $.ajax(e).done(function(e){n.resolve(e)}).fail(n.reject),n.promise()}function load(){console.log("populating ...");var e=getDevices(devicesConf).done(function(e){$devices=e,$(".table").droppable({tolerance:"fit",drop:function(e,n){var t=$(n.helper).clone(!1).removeClass("ui-draggable-dragging");$(this).append(t.draggable().selectable()),$(".element__del").click(function(){$(this).parent().remove()})}});var n=SortIdsByTypes($devices);renderElements($devices,n)});$.when(e).done(console.log("populating : done"))}function SortIdsByTypes(e){function n(e){var n={};return e.filter(function(e){return n.hasOwnProperty(e)?!1:n[e]=!0})}var o=e.map(function(e,n){return e.type}),r=e.map(function(e,n){return[e.type,e.id]}),l=n(o),a=[];for(t=0;t<l.length;t++){a[t]=[];l[t];for(a[t][0]=l[t],a[t][1]=[],i=0;i<r.length;i++)r[i][0]==l[t]&&a[t][1].push(r[i][1])}return a}function renderElements(e,n){for(i=0;i<n.length;i++){var t=function(e,t){return e.type==n[i][0]?!0:void 0},o=e.filter(t);$("div.elements__box").append('<div class="element " id="'+n[i][0]+'">'+n[i][0].replace(/_/g," ")+'<div class="element__counter">'+o.length+"</div></div>"),$(".element#"+n[i][0]).data(o).draggable({helper:"clone",revert:"invalid",start:function(e,n){return console.log($devices),n.helper.children("div").css("display","none").parent().addClass("element--inst").append('<span class="element__del">x</span>')}})}console.log($(".element#media_player").data()[2])}var devicesConf={url:"devices.json",type:"GET",dataType:"json",success:function(e){return e},error:function(e,n,t){alert("Sorry, there was a problem!"),console.log("Error: "+t),console.log("Status: "+n)},complete:function(e,n){console.log("conf: devices.json loaded")}};$(document).ready(function(){load()}).bind().ajaxStart(function(){$("#loading").show()}).ajaxStop(function(){$("#loading").hide()});